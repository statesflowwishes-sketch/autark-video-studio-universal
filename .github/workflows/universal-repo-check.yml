name: ğŸŒŸ Universal Repository Experience Check

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  documentation-structure:
    name: ğŸ“š 7-Layer Documentation Check
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ğŸ—ï¸ Verify 7-layer structure
        run: |
          echo "ğŸ” Checking 7-layer documentation structure..."
          
          # Layer 1: Gate
          test -f README.md || (echo "âŒ Gate layer missing (README.md)" && exit 1)
          echo "âœ… Gate layer found"
          
          # Layer 2: Index
          test -f docs/navigation-hub.md || (echo "âŒ Index layer missing" && exit 1)
          echo "âœ… Index layer found"
          
          # Layer 3: Atlas
          test -d docs/atlas || (echo "âŒ Atlas layer missing" && exit 1)
          test -f docs/atlas/architektur.md || (echo "âŒ Atlas architecture missing" && exit 1)
          test -f docs/atlas/konzepte.md || (echo "âŒ Atlas concepts missing" && exit 1) 
          test -f docs/atlas/sicherheit.md || (echo "âŒ Atlas security missing" && exit 1)
          test -f docs/atlas/glossar.md || (echo "âŒ Atlas glossary missing" && exit 1)
          echo "âœ… Atlas layer complete"
          
          # Layer 4: Werkzeughof
          test -f docs/tools/README.md || (echo "âŒ Werkzeughof layer missing" && exit 1)
          echo "âœ… Werkzeughof layer found"
          
          # Layer 5: Datenraum  
          test -f docs/data/README.md || (echo "âŒ Datenraum layer missing" && exit 1)
          echo "âœ… Datenraum layer found"
          
          # Layer 6: Showfloor
          test -f docs/demos/README.md || (echo "âŒ Showfloor layer missing" && exit 1)
          echo "âœ… Showfloor layer found"
          
          # Layer 7: Governance
          test -f docs/governance/README.md || (echo "âŒ Governance layer missing" && exit 1)
          echo "âœ… Governance layer found"
          
          echo "ğŸ‰ All 7 layers verified successfully!"

  universal-experience:
    name: ğŸ¯ Universal Experience Validation
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ•’ Check 30-second understand principle
        run: |
          # Check if README has quick overview section
          if grep -q "30 Sekunden" README.md; then
            echo "âœ… 30-second principle implemented"
          else
            echo "âš ï¸ 30-second principle not clearly implemented"
          fi
          
      - name: ğŸ” Check 5-minute find principle  
        run: |
          # Check navigation completeness
          if grep -q "navigation-hub" README.md; then
            echo "âœ… 5-minute find principle implemented"
          else
            echo "âš ï¸ Navigation system not linked"
          fi
          
      - name: ğŸ‘¥ Check 60-minute contribute principle
        run: |
          # Check governance documentation
          if test -f docs/governance/README.md; then
            echo "âœ… 60-minute contribute principle implemented"
          else
            echo "âŒ Contribution guidelines missing"
            exit 1
          fi

  accessibility-check:
    name: â™¿ Accessibility Validation
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ” Check accessibility features
        run: |
          echo "â™¿ Checking accessibility features..."
          
          # Check for alt texts in images
          if grep -r "alt=" docs/ README.md || true; then
            echo "âœ… Alt texts found"
          else
            echo "â„¹ï¸ No alt texts found - consider adding for images"
          fi
          
          # Check for ARIA labels
          if grep -r "aria-" docs/ README.md || true; then
            echo "âœ… ARIA labels found"
          else
            echo "â„¹ï¸ No ARIA labels found (optional but recommended)"
          fi
          
          echo "âœ… Accessibility check completed"

  quality-metrics:
    name: ğŸ“Š Quality Metrics
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“ˆ Calculate documentation coverage
        run: |
          echo "ğŸ“Š Calculating documentation metrics..."
          
          # Count documentation files
          DOC_FILES=$(find docs/ -name "*.md" | wc -l)
          echo "ğŸ“„ Documentation files: $DOC_FILES"
          
          # Count total lines in documentation
          DOC_LINES=$(find docs/ -name "*.md" -exec wc -l {} + | tail -1 | awk '{print $1}')
          echo "ğŸ“ Documentation lines: $DOC_LINES"
          
          # Check README size (should be substantial but not overwhelming)
          README_LINES=$(wc -l < README.md)
          echo "ğŸ“‹ README lines: $README_LINES"
          
          if [ $README_LINES -gt 50 ] && [ $README_LINES -lt 500 ]; then
            echo "âœ… README size optimal ($README_LINES lines)"
          else
            echo "âš ï¸ README might be too short (<50) or too long (>500) lines"
          fi
          
          echo "âœ… Quality metrics calculated"